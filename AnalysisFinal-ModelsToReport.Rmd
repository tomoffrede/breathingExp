---
title: "Regression models for paper - Breathing and speech adaptation"
author: "Tom Offrede"
date: "2022-09-21"
output:
  html_document:
    toc: true
    toc_float: 
      collapsed: false
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r, include = FALSE}
library(lme4)
library(tidyverse)
# library(influence.ME)
# library(MASS)

folder <- "C:/Users/offredet/Documents/1HU/ExperimentBreathing/Data/DataForAnalysis/AllData/"

`%!in%` <- Negate(`%in%`)

orderCond <- c("Sitting", "Light", "Heavy")
orderCondBase <- c("Baseline", "Sitting", "Light", "Heavy")
orderAct <- c("watching", "listening")
```

# Breathing data while listening/watching

## Participants

```{r, include=FALSE}
load(paste0(folder, "DataBreathing.RData"))

dat <- brm %>%
  filter(Role=="Participant", act %in% c("listening", "watching")) %>%
  filter(!duplicated(file)) %>% 
  mutate(breathCycle = gsub("cycle", "", breathCycle)) %>%
  mutate_at(c("Speaker", "act", "Condition", "Task", "Role"), as.factor) %>%
  mutate_at(c("numberIPUs", "numberBreathCycles", "breathCycle"), as.integer) %>%
  mutate(across(Condition, factor, levels=c("Sitting","Light","Heavy"))) %>%
  mutate(across(act, factor, levels=c("watching","listening"))) %>%
  group_by(Speaker) %>%
  mutate(inhalDurz = (inhalDur - mean(inhalDur, na.rm=TRUE) / sd(inhalDur, na.rm=TRUE)),
         inhalAmpz = (inhalAmp - mean(inhalAmp, na.rm=TRUE) / sd(inhalAmp, na.rm=TRUE)),
         breathRateZ = (breathRate - mean(breathRate, na.rm=TRUE) / sd(breathRate, na.rm=TRUE))) %>%
  ungroup() %>%
  mutate(logInhalDur = log(inhalDur),
         logInhalAmp = log(inhalAmp))

dat$Condition <- relevel(dat$Condition, ref = "Sitting")
dat$act <- relevel(dat$act, ref = "watching")
```

### Breathing rate

```{r}
ggplot(dat, aes(act, breathRate))+
  geom_boxplot()+
  facet_wrap(~Condition)
```

The model `breathing rate ~ act` (without `condition`) is the best model, but the graphs seem to visually indicate that there was a trend for an interaction with `condition`.

```{r}
summary(m2a <- lmer(breathRateZ ~ act + (1 |Speaker), dat))

par(mfrow=c(2, 2))
hist(resid(m2a))
qqnorm(resid(m2a));qqline(resid(m2a))
plot(fitted(m2a), resid(m2a))

summary(m2a <- lmer(breathRateZ ~ Condition + (1 |Speaker), dat %>% filter(act=="watching")))
```

We also have models about breath cycle durations, but those indicate the same things as breathing rate, since they're closely (negatively) related. So I say we shouldn't include the models about cycle durations.

The one interesting thing, though, was that breath cycles tended to be shorter the further into the recording they were. (Helene also observed this in her data.) I don't think this is relevant for our overall story, but let's keep it in mind.

```{r, include=FALSE}
dat <- brm %>%
  filter(Role=="Participant", act %in% c("watching", "listening")) %>%
  mutate(breathCycle = gsub("cycle", "", breathCycle)) %>%
  mutate_at(c("Speaker", "act", "Condition", "Task", "Role"), as.factor) %>%
  mutate_at(c("numberIPUs", "numberBreathCycles", "breathCycle"), as.integer) %>%
  mutate(across(Condition, factor, levels=c("Sitting","Light","Heavy"))) %>%
  mutate(across(act, factor, levels=c("watching","listening"))) %>%
  mutate(logCycleDur = log(cycleDur))

d <- dat %>% group_by(breathCycle) %>% mutate(cM = mean(cycleDur))
```

```{r}
plot(d$breathCycle, d$cM, ylab="mean of cycle durations", main="Cycle durations throughout the recordings")
```

### Inhalation duration

```{r, include=FALSE}
dat <- brm %>%
  filter(Role=="Participant", act %in% c("listening", "watching")) %>%
  mutate(breathCycle = gsub("cycle", "", breathCycle)) %>%
  mutate_at(c("Speaker", "act", "Condition", "Task", "Role"), as.factor) %>%
  mutate_at(c("numberIPUs", "numberBreathCycles", "breathCycle"), as.integer) %>%
  mutate(across(Condition, factor, levels=c("Sitting","Light","Heavy"))) %>%
  mutate(across(act, factor, levels=c("watching","listening"))) %>%
  group_by(Speaker)%>%
  mutate(inhalDurz = (inhalDur - mean(inhalDur, na.rm=TRUE) / sd(inhalDur, na.rm=TRUE)),
         inhalAmpz = (inhalAmp - mean(inhalAmp, na.rm=TRUE) / sd(inhalAmp, na.rm=TRUE))) %>%
  ungroup() %>%
  mutate(logInhalDur = log(inhalDur),
         logInhalAmp = log(inhalAmp))
```

```{r}
ggplot(dat, aes(act, inhalDurz))+
  geom_boxplot()+
  scale_x_discrete(limits = orderAct)
```

Although from the graph the difference between watching and listening isn't so clear, in the regression it seems to be (with a small effect size).

```{r}
summary(d2 <- lmer(logInhalDur ~ act + (1 + act | Speaker), dat))

par(mfrow=c(2, 2))
hist(resid(d2))
qqnorm(resid(d2));qqline(resid(d2))
plot(fitted(d2), resid(d2))
```

### Inhalation amplitude

```{r, include=FALSE}
dat <- brm %>%
  filter(Role=="Participant", act %in% c("listening", "watching")) %>%
  mutate(breathCycle = gsub("cycle", "", breathCycle)) %>%
  mutate_at(c("Speaker", "act", "Condition", "Task", "Role"), as.factor) %>%
  mutate_at(c("numberIPUs", "numberBreathCycles", "breathCycle"), as.integer) %>%
  mutate(across(Condition, factor, levels=c("Sitting","Light","Heavy"))) %>%
  mutate(across(act, factor, levels=c("watching","listening"))) %>%
  mutate(logInhalAmp = log(inhalAmp))

```

```{r}
ggplot(dat, aes(Condition, inhalAmp))+
  geom_boxplot()+
  scale_x_discrete(limits = orderCond)+
  facet_wrap(~act)
```

There's a significant interactional effect of act and condition on inhalation amplitude.

Remember that inhalation amplitude is indirectly, negatively related to breathing rate. So we can use this finding (during `watching`) to argue that, although we didn't replicate Paccalin & Jeannerod's finding directly, our finding may be related to theirs.

```{r}
dat$act <- relevel(dat$act, ref = "listening")
summary(a3 <- lmer(logInhalAmp ~ act * Condition + (1 | Speaker), dat))

par(mfrow=c(2, 2))
hist(resid(a3))
qqnorm(resid(a3));qqline(resid(a3))
plot(fitted(a3), resid(a3))
```



# Breathing data during FREE speech

## Participants

### Breathing rate

```{r, include=FALSE}
load(paste0(folder, "DataBreathing.RData"))

dat <- brm %>%
  filter(Role=="Participant", act=="speaking", Task=="Free") %>%
  filter(!duplicated(file)) %>% # for some reason if I do `!duplicated()` in the line above, it weirdly deletes a bunch of rows that shouldn't be
  mutate(breathCycle = gsub("cycle", "", breathCycle)) %>%
  mutate_at(c("Speaker", "act", "Condition", "Task", "Role"), as.factor) %>%
  mutate_at(c("numberIPUs", "numberBreathCycles", "breathCycle"), as.integer) %>%
  mutate(across(Condition, factor, levels=c("Baseline", "Sitting","Light","Heavy")))%>%
  mutate(logBreathRate = log(breathRate)) %>% 
  group_by(Speaker) %>% 
  mutate(breathRateZ = (breathRate - mean(breathRate)) / sd(breathRate)) %>% 
  ungroup %>% 
  mutate(Cond2 = ifelse(Condition == "Baseline", "Alone", "Interaction"))


dat$Condition <- relevel(dat$Condition, ref="Sitting")
```

```{r}
ggplot(dat, aes(Condition, breathRate))+
  geom_boxplot()
```

```{r}
ggplot(dat, aes(Cond2, breathRate))+
  geom_boxplot()
```

There is no significant difference in breathing rate between the conditions, but there is one between baseline (`Alone`) and all the experimental conditions (`Interaction`). Weirdly, the direction of this effect is **opposite** what we would expect: breathing is slower during the interaction, which contradicts what we thought about cognitive effort. I'm not sure how to deal with this.


```{r}
summary(b1a <- lmer(breathRateZ ~ Cond2 + (1 | Speaker), dat))

par(mfrow=c(2, 2))
hist(resid(b1a))
qqnorm(resid(b1a));qqline(resid(b1a))
plot(fitted(b1a), resid(b1a))
```

Same as before for the results on the duration of breath cycles (directly related to breathing rate).

### Inhalation duration

```{r, include=FALSE}
dat <- brm %>%
  filter(Role=="Participant", act=="speaking", Task=="Free") %>%
  mutate(breathCycle = gsub("cycle", "", breathCycle)) %>%
  mutate_at(c("Speaker", "act", "Condition", "Task", "Role"), as.factor) %>%
  mutate_at(c("numberIPUs", "numberBreathCycles", "breathCycle"), as.integer) %>%
  mutate(across(Condition, factor, levels=c("Baseline", "Sitting","Light","Heavy")))%>%
  mutate(logInhalDur = log(inhalDur)) %>% 
  group_by(Speaker) %>% 
  mutate(inhalDurz = (inhalDur - mean(inhalDur)) / sd(inhalDur)) %>% 
  ungroup() %>% 
  mutate(Cond2 = ifelse(Condition=="Baseline", "Alone", "Interaction")) # Cond2 = Alone vs Interaction
```

```{r}
ggplot(dat, aes(Condition, inhalDur))+
  geom_boxplot()+
  scale_x_discrete(limits = orderCondBase)

ggplot(dat, aes(numberIPUs, inhalDur))+
  geom_point()
```

There's an effect of `alone` vs `interaction` on inhalation duration. If you break it down into the different conditions, there's a nonlinear effect that doesn't make sense and is probably just noise. Same for inhalation amplitude below.

The number of IPUs in the subsequent exhalation also induces longer inhalations. This effect was bigger than the condition effect. We can relate this to previous findings on speech planning and breathing.

```{r}
summary(d4 <- lmer(logInhalDur ~ numberIPUs + Cond2 + (1 | Speaker), dat))

par(mfrow=c(2, 2))
hist(resid(d4))
qqnorm(resid(d4));qqline(resid(d4))
plot(fitted(d4), resid(d4))
```

### Inhalation amplitude

```{r, include=FALSE}
dat <- brm %>%
  filter(Role=="Participant", act=="speaking", Task=="Free") %>%
  mutate(breathCycle = gsub("cycle", "", breathCycle)) %>%
  mutate_at(c("Speaker", "act", "Condition", "Task", "Role"), as.factor) %>%
  mutate_at(c("numberIPUs", "numberBreathCycles", "breathCycle"), as.integer) %>%
  mutate(across(Condition, factor, levels=c("Baseline", "Sitting","Light","Heavy")))%>%
  mutate(logInhalAmp = log(inhalAmp)) %>% 
  group_by(Speaker) %>% 
  mutate(inhalAmpz = (inhalAmp - mean(inhalAmp)) / sd(inhalAmp)) %>% 
  mutate(Cond2 = ifelse(Condition == "Baseline", "Alone", "Interaction"))

dat$Condition <- relevel(dat$Condition, ref="Sitting")
```

```{r}
ggplot(dat, aes(Condition, inhalAmp))+
  geom_boxplot()+
  scale_x_discrete(limits = orderCondBase)

ggplot(dat, aes(numberIPUs, inhalAmp))+
  geom_point()
```

Again, there's a difference between `alone` and `interaction`. (A regression on the different conditions suggests there's a significant difference between `sitting` and `heavy biking` but not between `sitting` and `light biking`, so this is probably just noise.)

Same finding about number of IPUs and inhalation amplitude as for inhalation duration.

Choose either inhalation duration or amplitude to report since they have the same results.

```{r}
summary(a2 <- lmer(logInhalAmp ~ Cond2 + numberIPUs + (1 | Speaker), dat))

par(mfrow=c(2, 2))
hist(resid(a2))
qqnorm(resid(a2));qqline(resid(a2))
plot(fitted(a2), resid(a2))
```

### Number of IPUs per breath cycle?

We also have some results on the number of IPUs per cycle, but I'm not sure if it's relevant for us to report. The model is `numberIPUs ~ breathCycle + BMI + InterEnjoy`, where `breathCycle` is how far into the recording it is, `BMI` is body mass index and `InterEnjoy` is the participants' rating of how much they enjoyed the interaction.

## Confederate

```{r, include=FALSE}
load(paste0(folder, "DataBreathing.RData"))
```

### Breathing rate

```{r, include=FALSE}
dat <- brm %>%
  filter(Role=="Confederate", !duplicated(file)) %>%
  mutate(breathCycle = gsub("cycle", "", breathCycle)) %>%
  mutate_at(c("Speaker", "Condition"), as.factor) %>%
  mutate_at(c("numberIPUs", "numberBreathCycles", "breathCycle"), as.integer) %>%
  mutate(across(Condition, factor, levels=c("Sitting","Light","Heavy")))

dat$Condition <- relevel(dat$Condition, ref="Sitting")
```

The blue points are the actual data points (it's only three per condition). If we show this graph, I don't know if boxplots or points are better.

```{r}
ggplot(dat, aes(Condition, breathRate))+
  geom_boxplot()+
  geom_point(size=2, color="blue")
```

For the confederate, breathing rate increased steadily with physical effort.

(We obtain the same results with breath cycle durations.)

```{r}
dat$Condition <- relevel(dat$Condition, ref="Light")
summary(b1 <- lm(breathRate ~ Condition, dat))

par(mfrow=c(2, 2))
hist(resid(b1))
qqnorm(resid(b1));qqline(resid(b1))
plot(fitted(b1), resid(b1))
```

### Inhalation duration

```{r, include=FALSE}
dat <- brm %>%
  filter(Role=="Confederate") %>%
  mutate(breathCycle = gsub("cycle", "", breathCycle)) %>%
  mutate_at(c("Speaker", "Condition"), as.factor) %>%
  mutate_at(c("numberIPUs", "numberBreathCycles", "breathCycle"), as.integer) %>%
  mutate(across(Condition, factor, levels=c("Sitting","Light","Heavy"))) %>%
  mutate(logInhalDur = log(inhalDur))

dat$numberIPUs <- as.factor(dat$numberIPUs)
dat$Condition <- relevel(dat$Condition, ref="Light")
```

```{r}
ggplot(dat, aes(Condition, inhalDur))+
  geom_boxplot()+
  scale_x_discrete(limits = orderCond)
```

Inhalation duration is longer during biking (`light` or `heavy`) than `sitting`.

```{r}
summary(d1 <- lm(logInhalDur ~ Condition, dat))
```



```{r}
# ggplot(dat, aes(Condition, as.numeric(numberIPUs)))+
#   geom_violin()
```


```{r}
# summary(n3 <- MASS::polr(numberIPUs ~ Condition * breathCycle, data=dat, Hess=TRUE))
```


# Breathing data during READ speech

## Participants

### Breathing rate

```{r, include=FALSE}
dat <- brm %>%
  filter(Role=="Participant", grepl("Read", Task)) %>%
  filter(!duplicated(file)) %>% 
  mutate(breathCycle = gsub("cycle", "", breathCycle)) %>%
  mutate_at(c("Speaker", "act", "Condition", "Task", "Role"), as.factor) %>%
  mutate_at(c("numberIPUs", "numberBreathCycles", "breathCycle"), as.integer) %>%
  mutate(across(Condition, factor, levels=c("Baseline", "Sitting","Light","Heavy"))) %>%
  mutate(across(act, factor, levels=c("watching","listening"))) %>%
  group_by(Speaker) %>%
  mutate(breathRateZ = (breathRate - mean(breathRate, na.rm=TRUE) / sd(breathRate, na.rm=TRUE))) %>%
  ungroup() %>% 
  mutate(logBreathRate = log(breathRate),
         Cond2 = ifelse(Condition == "Baseline", "Alone", "Interaction"))

dat$Condition <- relevel(dat$Condition, ref="Sitting")
```

```{r}
ggplot(dat, aes(Condition, breathRate))+
  geom_boxplot()+
  scale_x_discrete(limits = orderCondBase)
```

During read speech there's also an `alone` vs `interaction` effect on breathing rate. **However**, this difference is in the **opposite** direction from free speech. Here, breathing is faster during the interaction, which makes more sense in terms of cognitive effort.

The residuals have a few outliers -- do I just remove outlying data points?

```{r}
summary(b1 <- lmer(breathRateZ ~ Cond2 + (1 | Speaker), dat))

par(mfrow=c(2, 2))
hist(resid(b1))
qqnorm(resid(b1));qqline(resid(b1))
plot(fitted(b1), resid(b1))
```

### Inhalation duration

```{r, include=FALSE}
dat <- brm %>%
  filter(Role=="Participant", grepl("Read", Task)) %>%
  mutate(breathCycle = gsub("cycle", "", breathCycle)) %>%
  mutate_at(c("Speaker", "act", "Condition", "Task", "Role"), as.factor) %>%
  mutate_at(c("numberIPUs", "numberBreathCycles", "breathCycle"), as.integer) %>%
  mutate(across(Condition, factor, levels=c("Baseline", "Sitting","Light","Heavy")))%>%
  mutate(logInhalDur = log(inhalDur),
         inhalDurz = (inhalDur - mean(inhalDur)) / sd(inhalDur),
         Cond2 = ifelse(Condition=="Baseline", "Alone", "Interaction")) # Cond2 = Alone vs Interaction)

dat$Condition <- relevel(dat$Condition, ref="Sitting")
```

```{r}
ggplot(dat %>% filter(inhalDur < 3), aes(Condition, inhalDur))+
  geom_boxplot()+
  scale_x_discrete(limits = orderCondBase)
```

Inhalation duration changes in the opposite direction from expected. It's a small effect.

Inhalations also get shorter the further into the recording they are, like for cycle durations above. If we report the model about inhalation duration, I suggest we only leave the `condition` predictor, unless we want to talk about this change in durations across the task.

```{r}
summary(d5 <- lmer(logInhalDur ~ Condition + (1 | Speaker), dat))

par(mfrow=c(2, 2))
hist(resid(d5))
qqnorm(resid(d5));qqline(resid(d5))
plot(fitted(d5), resid(d5))
```

### Inhalation amplitude

```{r, include=FALSE}
dat <- brm %>%
  filter(Role=="Participant", grepl("Read", Task)) %>%
  mutate(breathCycle = gsub("cycle", "", breathCycle)) %>%
  mutate_at(c("Speaker", "act", "Condition", "Task", "Role"), as.factor) %>%
  mutate_at(c("numberIPUs", "numberBreathCycles", "breathCycle"), as.integer) %>%
  mutate(across(Condition, factor, levels=c("Baseline", "Sitting","Light","Heavy")))%>%
  mutate(logInhalAmp = log(inhalAmp)) %>% 
  group_by(Speaker) %>% 
  mutate(inhalAmpz = (inhalAmp - mean(inhalAmp)) / sd(inhalAmp)) %>% 
  ungroup() %>% 
  mutate(Cond2 = ifelse(Condition=="Baseline", "Alone", "Interaction"))

dat$Condition <- relevel(dat$Condition, ref="Sitting")
```

```{r}
ggplot(dat, aes(Cond2, inhalAmp))+
  geom_boxplot()
```

Again the `alone` vs `interaction` effect for inhalation amplitude. Dividing it by condition gave a weird, nonlinear result (probably noise). There was also an effect for `breathCycle` (smaller inhalations the further into the recording), as above.

```{r}
summary(a2 <- lmer(logInhalAmp ~ Cond2 + (1 | Speaker), dat))

par(mfrow=c(2, 2))
hist(resid(a2))
qqnorm(resid(a2));qqline(resid(a2))
plot(fitted(a2), resid(a2))
```

## Confederate

### Breathing rate

```{r, include=FALSE}
load(paste0(folder, "DataBreathing.RData"))

df <- brm %>%
  filter(grepl("Read", Task), Speaker == "Confederate") %>%
  mutate(grouping = paste0(Condition, Task, file)) %>% 
  filter(!duplicated(grouping)) %>%
  select(-grouping) %>% 
  mutate(across(Condition, factor, levels=c("Sitting","Light","Heavy")))

df$Condition <- relevel(df$Condition, ref="Sitting")
```

```{r}
ggplot(df, aes(Condition, breathRate))+
  geom_boxplot()+
  geom_point()
```

During read speech, the confederate's breathing rate had this weird nonlinear pattern -- is it just noise? (How) do we even report this?

```{r}
df$Condition <- relevel(df$Condition, ref="Sitting")
summary(b1 <- lm(breathRate ~ Condition, df))
```


# Speech data: FREE speech

## Participants

```{r, include=FALSE}
folder <- "C:/Users/offredet/Documents/1HU/ExperimentBreathing/Data/DataForAnalysis/AllData/"

load(paste0(folder, "DataSpeech.RData"))
```

### f0

```{r, include=FALSE}
df <- fsm %>%
  filter(Task == "Free", Role == "Participant") %>%
  group_by(Speaker)%>%
  mutate(f0IPUz = (f0raw - mean(f0raw, na.rm=TRUE)) / sd(f0raw, na.rm=TRUE),
         f0filez = (f0IPUmean - mean(f0IPUmean, na.rm=TRUE)) / sd(f0IPUmean, na.rm=TRUE)) %>%
  ungroup() %>% 
  mutate(f0Zgeneral = (f0raw - mean(f0raw, na.rm=TRUE)) / sd(f0raw, na.rm=TRUE)) %>% 
  filter(abs(f0Zgeneral) < 2) %>% 
  mutate(across(Condition, factor, levels=c("Baseline", "Sitting","Light","Heavy"))) %>% 
  mutate(Cond2 = ifelse(Condition == "Baseline", "Alone", "Interaction"))

df$Condition <- relevel(df$Condition, ref="Sitting")
```

```{r}
ggplot(df, aes(Condition, f0raw))+
  geom_boxplot()+
  scale_x_discrete(limits = orderCondBase)
```


f0 didn't change with condition.

```{r}
summary(m1 <- lmer(f0IPUz ~ Condition + (1 + Condition | Speaker), df))

par(mfrow=c(2, 2))
plot(fitted(m1), residuals(m1))
qqnorm(resid(m1));qqline(resid(m1)) # residuals ok I think
hist(resid(m1))
```

### Articulation Rate

```{r, include=FALSE}
df <- fsm %>%
  filter(Task == "Free", Role == "Participant") %>%
  group_by(Speaker)%>%
  mutate(SRipuZ = (speechRateIPU - mean(speechRateIPU, na.rm=TRUE)) / sd(speechRateIPU, na.rm=TRUE)) %>%
  ungroup() %>% 
  mutate(SRZgeneral = (speechRateIPU - mean(speechRateIPU, na.rm=TRUE)) / sd(speechRateIPU, na.rm=TRUE)) %>% 
  mutate(across(Condition, factor, levels=c("Baseline", "Sitting","Light","Heavy"))) %>% 
  mutate(Cond2 = ifelse(Condition == "Baseline", "Alone", "Interaction"))


df$Condition <- relevel(df$Condition, ref="Light")
```

```{r}
ggplot(df, aes(Condition, speechRateIPU))+
  geom_boxplot()+
  scale_x_discrete(limits = orderCondBase)+
  ggtitle("Participants' articulation rate")

ggplot(df, aes(Cond2, speechRateIPU))+
  geom_boxplot()+
  ggtitle("Participants' articulation rate")
```

There seems to be a `alone` vs `interaction` effect, but if we include `order` and `breath cycle duration` in the model (see below), the condition effect disappears (or including only `order`).

(The residuals of this model are crazy though! Not sure why. Is it because the categorical predictor is binary?)

```{r}
summary(s5a <- lmer(SRipuZ ~ Cond2 + (1 | Speaker),  df))

par(mfrow=c(2, 2))
hist(resid(s5a))
qqnorm(resid(s5a));qqline(resid(s5a))
plot(fitted(s5a), resid(s5a))
```

If we include only `order` and `breath cycle duration` in the model, we see an effect of those. `Order` might be a nice effect to talk about (because it happens over time, and we're talking about convergence over time), but because the effect disappears in the `condition + order` model, I'm not sure how robust these models are.

```{r}
summary(s5a <- lmer(SRipuZ ~ Order +  breathCycleDur + (1 | Speaker),  df %>% filter(!is.na(breathCycleDur))))

par(mfrow=c(2, 2))
hist(resid(s5a))
qqnorm(resid(s5a));qqline(resid(s5a)) # residuals seem ok I think
plot(fitted(s5a), resid(s5a))
```

## Confederate

```{r, include=FALSE}
load(paste0(folder, "DataSpeech.RData"))

df <- fsm %>%
  filter(Task == "Free", Speaker == "Confederate") %>%
  # select(c("file", "Speaker", "IPU", "f0raw", "f0IPUmean", "speechRateIPU", "durSpeech", "durPauses", "speechRate", "articRate", "Condition", "breathCycleDurMean", "breathRate", "breathCycleDur")) %>%
  mutate(f0IPUz = (f0raw - mean(f0raw, na.rm=TRUE)) / sd(f0raw, na.rm=TRUE),
         f0filez = (f0IPUmean - mean(f0IPUmean, na.rm=TRUE)) / sd(f0IPUmean, na.rm=TRUE),
         SRipuZ = (speechRateIPU - mean(speechRateIPU, na.rm=TRUE)) / sd(speechRateIPU, na.rm=TRUE))

df$Condition <- relevel(df$Condition, ref="Light")
```

### f0

```{r}
ggplot(df, aes(Condition, f0IPUz))+
  geom_boxplot()+
  scale_x_discrete(limits = orderCond)
```

f0 got consistently higher with physical effort.

```{r}
summary(m1 <- lm(f0IPUz ~ Condition, df))

par(mfrow=c(2, 2))
hist(resid(m1))
qqnorm(resid(m1));qqline(resid(m1))
plot(fitted(m1), resid(m1))
```

### Articulation rate

```{r}
ggplot(df, aes(Condition, speechRateIPU))+
  geom_boxplot()+
  scale_x_discrete(limits = orderCond)
```

Articulation rate did not change according to physical effort.

```{r}
summary(s1 <- lm(SRipuZ ~ Condition, df))
```


# Speech data: READ speech

**We only have f0 data (no speech rate) for read speech**

```{r, include=FALSE}
load(paste0(folder, "DataReadSpeech.RData"))
```

## Participants

### f0

```{r, include=FALSE}
df <- frb %>% 
  filter(Role == "Participant", grepl("Read", Task)) %>% 
  group_by(Speaker)%>%
  mutate(f0IPUz = (f0raw - mean(f0raw, na.rm=TRUE)) / sd(f0raw, na.rm=TRUE),
         SRipuZ = (speechRateIPU - mean(speechRateIPU, na.rm=TRUE)) / sd(speechRateIPU, na.rm=TRUE)) %>%
  ungroup() %>% 
  mutate(f0Zgeneral = (f0raw - mean(f0raw, na.rm=TRUE)) / sd(f0raw, na.rm=TRUE),
         Cond2 = ifelse(Condition == "Baseline", "Alone", "Interaction")) %>% 
  filter(abs(f0Zgeneral) < 2) %>% 
  mutate(across(Condition, factor, levels=c("Baseline", "Sitting","Light","Heavy")))
```


```{r}
ggplot(df, aes(Condition, f0IPUz))+
  geom_boxplot()
```

During read speech f0 went up as per our hypothesis. When trying to entrain temporally to the confederate, do they also entrain on f0? (Or what other explanations do we have?)

```{r}
summary(f1 <- lmer(f0IPUz ~ Condition + (1 | Speaker), df))
```

### Articulation rate

```{r}
ggplot(df, aes(Condition, SRipuZ))+
  geom_boxplot()
```

```{r}
df$Condition <- relevel(df$Condition, ref="Sitting")
summary(s1 <- lmer(SRipuZ ~ Condition + (1 | Speaker), df))

summary(s2 <- lmer(SRipuZ ~ Cond2 + (1 | Speaker), df))
```



## Confederate

### f0

```{r, include=FALSE}
load(paste0(folder, "DataReadSpeech.RData"))
df <- frb %>%
  filter(grepl("Hirs|Schw|Pfer", file), Speaker == "Confederate") %>% 
  mutate(f0IPUz = (f0raw - mean(f0raw, na.rm=TRUE)) / sd(f0raw, na.rm=TRUE))

# df <- full_join(df, srr, by=c("file", "IPU"), all=TRUE)
# df$speechRateIPU.x <- NULL
# df <- df %>% rename(speechRateIPU=speechRateIPU.y)
# df <- df[!is.na(df$Condition),]

df$Condition <- relevel(df$Condition, ref="Light")
```

```{r}
ggplot(df, aes(Condition, f0IPUz))+
  geom_boxplot()+
  scale_x_discrete(limits = orderCond)
```

During reading the confederate also increases f0 consistently with physical effort.

```{r}
summary(f1 <- lm(f0IPUz ~ Condition, df))
```

### Articulation rate

```{r}
ggplot(df, aes(Condition, speechRateIPU))+
  geom_boxplot()+
  scale_x_discrete(limits = orderCond)
```

The confederate only speaks faster during heavy biking, but at the same speed during sitting and light biking. Remember this is during *read* speech.

```{r}
df$Condition <- relevel(df$Condition, ref="Sitting")
summary(s1 <- lm(speechRateIPU ~ Condition, df))
```

